$(".article_view_container").fadeOut(function(){
	$("body").animate({
		backgroundColor:$.xcolor.darken('<%= @page.background_color %>',3,10)
	}, function(){
		$(".article_view_fragments_container .fragment_container").popover('hide');
	
		$(".article_view_fragments_container").html("<%= escape_javascript(render @fragments, popover_controls: true )%>");
		
		$(".previous_page_link_container").html("<%= escape_javascript(render 'articles/previous_page_link')%>");
		$(".next_page_link_container").html("<%= escape_javascript(render 'articles/next_page_link')%>");
		
		//Puzzle resources
		<%= render 'fragments/fragments_filling_script' %>
		$("#fragments_styles").html("<%= escape_javascript(render 'fragments/fragments_styles')%>");
		
		//Fragments initialization
		initializeAllFragments();
		
		$(".article_view_container").fadeIn(function(){
			//Fragments controls initialization
			initializeArticleFragmentEditControls();
			initializeControlsPopovers();
		});
	});
	
});

