<%
	frag_type = @fragment.fragment_type
%>

fragments_methods = {
	<% @fragment_types.each do |k,frag_type| %>
		<%= k %>: {
			view:function(fragment){
				$("#fragment_"+fragment.id+"_view *").unbind();//Per evitare che all'aggiornamento della view si debba fare l'unbind di ogni evento per poi riassociarlo
				<%= raw(frag_type.view_script.to_s) %>
				},
			edit:function(fragment){
				$("#fragment_"+fragment.id+"_edit *").unbind();
				<%= raw(frag_type.edit_script.to_s) %>
				},
		},
	<% end %>
};

$("#fragments_styles").html("<%= escape_javascript(render 'fragments/fragments_styles')%>");


$(".article_edit_fragments_container").append("<%= escape_javascript(render @fragment, fragment:@fragment, edit:true, popover_controls: true, article_fragment_edit_controls:true) %>");

var fragment = <%= raw(@fragment.to_json) %>;
addFragmentHiddenFields(fragment);
fragments.push(fragment);
initializeFragment(fragment);
initializeControlsPopovers();
initializeArticleFragmentEditControls();


closeModal();